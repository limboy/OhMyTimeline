<!--é…ç½®é¡¹å¼€å§‹-->
<script>
  const config = `
# ä»å“ªä¸€å¹´å¼€å§‹å±•ç¤º
startYear: 1984

# å¤´åƒåœ°å€
avatar: https://limboy.me/logo.jpg

# ä½ çš„åå­—
name: Limboy

# ä¸€ä¸ªå‰ªçŸ­çš„è¯´æ˜
bio: get busy living or get busy dying

timeline:
# ä¼šå±•ç¤ºåœ¨å·¦è¾¹æ 
- title: æ•™è‚²

# å¯é€‰é¡¹ä½ line æˆ–è€… barï¼Œå‰è€…æ˜¯æ¨ªçº¿ï¼Œåè€…æ˜¯æ–¹å—ï¼Œé€šå¸¸ç”¨æ¥å±•ç¤ºæ•°å€¼ï¼Œå‚è€ƒã€Œæ”¶å…¥ã€
  displayType: line

  items:
# å¼€å§‹çš„æ—¶é—´ç‚¹ï¼Œæ ¼å¼ä¸º å¹´.æœˆï¼Œç»“æŸæ—¶é—´åŒ
  - startDate: '1991.9'
    endDate: '1997.7'
# å¯¹å½“å‰è¿™æ®µæ—¶é—´çš„æè¿°
    desc: å°å­¦
  - startDate: '1997.9'
    endDate: '2000.7'
    desc: ä¸­å­¦
  - startDate: '2000.9'
    endDate: '2003.7'
    desc: é«˜ä¸­
  - startDate: '2003.9'
    endDate: '2007.7'
    desc: å¤§å­¦ï¼ˆå¤§è¿ç†å·¥ï¼‰

- title: æ—…è¡Œ
  displayType: line
  items:
  - startDate: '2014.11'
    endDate: '2014.11'
    desc: æ¸…è¿ˆ
  - startDate: '2015.6'
    endDate: '2015.6'
    desc: å°åŒ—
  - startDate: '2016.2'
    endDate: '2016.2'
    desc: æ™®å‰å²›
  - startDate: '2016.10'
    endDate: '2016.10'
    desc: æ—¥æœ¬
  - startDate: '2018.6'
    endDate: '2018.6'
    desc: æ—¥æœ¬
  - startDate: '2018.12'
    endDate: '2018.12'
    desc: æ—¥æœ¬
  - startDate: '2016.12'
    endDate: '2016.12'
    desc: é¦™æ¸¯
  - startDate: '2017.6'
    endDate: '2017.6'
    desc: ç¾å›½ï¼ˆWWDCï¼‰
  - startDate: '2020.1'
    endDate: '2020.1'
    desc: æ—¥æœ¬

- title: æ”¶å…¥
  displayType: bar
  valueDesc: (Percent)
  items:
  - startDate: '2008.5'
    endDate: '2009.4'
    desc: æ—¶å…‰ç½‘
    value: 0.05
  - startDate: '2010.4'
    endDate: '2011.7'
    desc: å‡¤å‡°ç½‘
    value: 0.1
  - startDate: '2011.7'
    endDate: '2012.4'
    value: 0.15
    desc: çŸ¥ä¹
  - startDate: '2013.6'
    endDate: '2014.11'
    value: 0.25
    desc: èŠ±ç“£
  - startDate: '2014.11'
    endDate: '2018.6'
    value: 0.4
    desc: è˜‘è‡è¡—
  - startDate: '2019.6'
    endDate: '2021.7'
    value: 1
    desc: å­—èŠ‚è·³åŠ¨

- title: ä¸€äº›å°äº‹
  displayType: line
  items:
  - startDate: '2007.6'
    endDate: '2007.6'
    desc: è·‘å®Œé©¬æ‹‰æ¾å…¨ç¨‹ï¼Œç”¨æ—¶4ä¸ªåŠå°æ—¶ï¼Œç¬¬ 173 åï¼ˆå…± 8500 äººå‚èµ›ï¼‰
  - startDate: '2007.5'
    endDate: '2007.5'
    desc: ç¬¬ä¸€æ¡æ¨
    url: https://twitter.com/lzyy/status/64679152?s=20
  - startDate: '2010.8'
    endDate: '2010.8'
    desc: ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« 
    url: https://limboy.me/2010/08/25/make-github-as-blog-engine/
  - startDate: '2011.4'
    endDate: '2011.4'
    desc: ç¬¬ä¸€å°è‹¹æœè®¾å¤‡ï¼ˆMacbook Airï¼‰
  - startDate: '2014.7'
    endDate: '2014.7'
    desc: ä½œä¸ºè®²å¸ˆåœ¨ Arch Summit å¤§ä¼šï¼ˆæ·±åœ³ï¼‰åšåˆ†äº«
  - startDate: '2018.8'
    endDate: '2018.8'
    desc: å’Œè€èƒ¡å»é¦™æ¸¯çœ‹ Bob Dylan æ¼”å”±ä¼š
  - startDate: '2021.3'
    endDate: '2021.3'
    desc: å†™äº†ä¸ªè´ªåƒè›‡ç¼–ç¨‹æ¸¸æˆï¼Œå¹¶åœ¨éƒ¨é—¨å†…éƒ¨ç»„ç»‡ç¼–ç¨‹æ¯”èµ›
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: çš‡å®¤æˆ˜äº‰ 6500 æ¯

- title: å…¬å¸
  displayType: line
  items:
  - startDate: '2008.5'
    endDate: '2009.4'
    desc: æ—¶å…‰ç½‘ï¼ˆFlashå¼€å‘)
  - startDate: '2010.4'
    endDate: '2011.7'
    desc: å‡¤å‡°ç½‘ï¼ˆPHPå·¥ç¨‹å¸ˆï¼‰
  - startDate: '2011.7'
    endDate: '2012.4'
    desc: çŸ¥ä¹ï¼ˆåç«¯ Python å·¥ç¨‹å¸ˆï¼‰
  - startDate: '2013.6'
    endDate: '2014.11'
    desc: èŠ±ç“£ï¼ˆiOS Devï¼‰
  - startDate: '2014.11'
    endDate: '2018.6'
    desc: è˜‘è‡è¡—ï¼ˆiOS Devï¼‰
  - startDate: '2019.6'
    endDate: '2021.7'
    desc: å­—èŠ‚è·³åŠ¨ï¼ˆiOS Devï¼‰

- title: åŸå¸‚
  displayType: line
  items:
  - startDate: '1984.12'
    endDate: '2003.7'
    desc: å®æ³¢
  - startDate: '2003.8'
    endDate: '2007.7'
    desc: å¤§è¿
  - startDate: '2007.8'
    endDate: '2007.10'
    desc: ä½›å±±
  - startDate: '2007.11'
    endDate: '2008.4'
    desc: å¤§è¿
  - startDate: '2008.5'
    endDate: '2012.4'
    desc: åŒ—äº¬
  - startDate: '2012.5'
    endDate: '2021.9'
    desc: æ­å·

- title: å½±è§†å‰§
  displayType: line
  items:
  - startDate: '2021.4'
    endDate: '2021.4'
    desc: é’¢ç´å®¶
  - startDate: '2021.4'
    endDate: '2021.4'
    desc: èŠåŠ å“¥ä¸ƒå›å­
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: é£ç­
  - startDate: '2021.7'
    endDate: '2021.7'
    desc: åŒå±‚å…¬å¯“ï¼šéƒ½ä¼šç”·å¥³
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: è™ç‰™ç‹¼äººæ€
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: å¤§å°è°è¨€
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: çŸ­å‰§å¼€å§‹å•¦
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: ç››å¤æœªæ¥
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: æ€’ç«Â·é‡æ¡ˆ

- title: é˜…è¯»
  displayType: line
  items:
  - startDate: '2020.1'
    endDate: '2020.1'
    desc: ä½ å½“åƒé¸Ÿé£å¾€ä½ çš„å±±
  - startDate: '2021.3'
    endDate: '2021.3'
    desc: Why We Sleep
  - startDate: '2021.6'
    endDate: '2021.6'
    desc: è½¯ä»¶è®¾è®¡çš„å“²å­¦
  - startDate: '2021.6'
    endDate: '2021.6'
    desc: åˆ›æ–°è€…
  - startDate: '2021.6'
    endDate: '2021.6'
    desc: å¤œæ™šçš„æ½œæ°´è‰‡
  - startDate: '2021.6'
    endDate: '2021.7'
    desc: How Computer Really Works
  - startDate: '2021.7'
    endDate: '2021.7'
    desc: How to Live
  - startDate: '2021.7'
    endDate: '2021.7'
    desc: 10 åˆ†é’Ÿå†¥æƒ³
  - startDate: '2021.7'
    endDate: '2021.7'
    desc: You don't know js
  - startDate: '2021.7'
    endDate: '2021.8'
    desc: å¤§è„‘çš„æ•…äº‹
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: ç¤¾äº¤å¤©æ€§
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: ä½ çš„å¤å¤©è¿˜å¥½å—
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: è¢«è®¨åŒçš„å‹‡æ°”
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: æ¶æ„
  - startDate: '2021.8'
    endDate: '2021.8'
    desc: ä¸Šå¸æ·éª°å­å—

  `;
</script>
<!--é…ç½®é¡¹ç»“æŸ-->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>OhMyTimeline</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.7/dist/tailwind.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.2.4/dist/cdn.js"
    ></script>
    <script>
      const timelineData = jsyaml.load(config);
      const timelineDates = (() => {
        let dates = [];
        for (let i = timelineData.startYear; i <= 2022; i++) {
          let item = { year: i, months: [] };
          for (let j = 1; j <= 12; j++) {
            item.months.push(j);
          }
          dates.push(item);
        }
        return dates;
      })();

      const monthOfDates = (date1, date2) => {
        let date1Year, date1Month, date2Year, date2Month;
        [date1Year, date1Month] = date1.split('.');
        [date2Year, date2Month] = date2.split('.');
        return (
          (parseInt(date2Year) - parseInt(date1Year)) * 12 +
          (parseInt(date2Month) - parseInt(date1Month))
        );
      };

      const convertDateToIndex = (date) => {
        let year, month;
        [year, month] = date.split('.');
        let yearIndex = parseInt(year) - timelineData.startYear;
        return [yearIndex, month - 1];
      };

      const convertDateToPixels = (date) => {
        let yearIndex, monthIndex;
        [yearIndex, monthIndex] = convertDateToIndex(date);

        return (
          (12 * yearIndex + monthIndex) * Alpine.store('pixelsPerMonth').width
        );
      };

      const monthsBetweenDates = (date1, date2) => {
        let date1Year, date1Month, date2Year, date2Month;
        [date1Year, date1Month] = date1.split('.');
        [date2Year, date2Month] = date2.split('.');
        return (date2Year - date1Year) * 12 + (date2Month - date1Month);
      };

      const sectionHeight = (section) => {
        if (section.displayType == 'bar') {
          return Alpine.store('sectionHeight');
        }

        let nthFloor = floorOfItemIndex(section, section.items.length - 1)[0];

        let height = Alpine.store('sectionHeight');
        return (
          Alpine.store('sectionItemMargin') +
          (Alpine.store('sectionItemMargin') +
            Alpine.store('sectionItemHeight')) *
            (nthFloor + 1)
        );
      };

      const timelineHeight = () => {
        let height = 0;
        timelineData.timeline.forEach((section) => {
          height += sectionHeight(section);
        });
        return height;
      };

      // è¿”å›ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ€»å±‚æ•°ï¼Œæ–¹ä¾¿è®¡ç®— heightï¼Œç¬¬äºŒä¸ªæ˜¯è¯¥ itemIndex æ‰€åœ¨çš„å±‚æ•°ï¼Œæ–¹ä¾¿å±•ç¤º
      const floorOfItemIndex = (section, itemIndex) => {
        let items = [];
        let filled = [];
        let positionLevel = -1;

        for (let i = 0; i <= itemIndex; i++) {
          items.push(section.items[i]);
        }

        items.forEach((item, index) => {
          let foundPosition = false;
          let months = monthsBetweenDates(item.startDate, item.endDate);
          let startIndex = monthsBetweenDates(
            timelineData.startYear + '.1',
            item.startDate
          );

          for (let i = 0; i < filled.length; i++) {
            let positionTaken = false;
            for (let j = 0; j <= months; j++) {
              positionTaken = filled[i].find(
                (index) => index == startIndex + j
              );
              if (positionTaken) {
                break;
              }
            }

            if (!positionTaken) {
              foundPosition = true;
              for (let k = 0; k <= months; k++) {
                filled[i].push(startIndex + k);
              }

              // å¦‚æœæ˜¯æœ€åä¸€ä¸ªï¼Œè¯´æ˜æ‰¾åˆ°äº†
              if (index == itemIndex) {
                positionLevel = i;
              }
              break;
            }
          }

          if (!foundPosition) {
            let positions = [];
            for (let i = 0; i <= months; i++) {
              positions.push(startIndex + i);
            }
            filled.push(positions);
          }
        });

        // ä»ç¬¬ 0 å±‚å¼€å§‹ç®—èµ·
        return [
          filled.length - 1,
          positionLevel == -1 ? filled.length - 1 : positionLevel,
        ];
      };

      const heightOfBarItemIndex = (section, itemIndex) => {
        let maxValue = Math.max(...section.items.map((item) => item.value));
        return Math.ceil(
          (section.items[itemIndex].value / maxValue) *
            Alpine.store('maxBarHeight')
        );
      };

      const widthOfBarItem = (item) => {
        let months = monthsBetweenDates(item.startDate, item.endDate) + 1;
        return months * Alpine.store('pixelsPerMonth').width;
      };

      const stretchBtnClick = (timelineArea) => {
        let normalWidth = 20;
        let stretchWidth = 80;
        let currentWidth = Alpine.store('pixelsPerMonth').width;
        Alpine.store('pixelsPerMonth').width =
          currentWidth == stretchWidth ? normalWidth : stretchWidth;
        if (currentWidth == normalWidth) {
          setTimeout(() => {
            timelineArea.scroll(
              timelineArea.scrollLeft * (stretchWidth / normalWidth),
              timelineArea.scrollTop
            );
          }, 0);
        } else {
          timelineArea.scroll(
            timelineArea.scrollLeft / (stretchWidth / normalWidth),
            timelineArea.scrollTop
          );
        }
      };

      document.addEventListener('alpine:init', () => {
        Alpine.store('timelineData', timelineData);
        Alpine.store('timelineDates', timelineDates);
        Alpine.store('monthOfDates', monthOfDates);
        Alpine.store('monthBarHeight', 24);
        Alpine.store('headerHeight', 186);
        Alpine.store('endYear', 2022);
        Alpine.store('sectionHeight', 33);
        Alpine.store('barColor', '#2564eb');
        Alpine.store('lineColor', '#2564eb');
        Alpine.store('timelineHeight', timelineHeight);
        Alpine.store('sectionTotalHeight', sectionHeight);
        Alpine.store('convertDateToPixels', convertDateToPixels);
        Alpine.store('monthsBetweenDates', monthsBetweenDates);
        Alpine.store('floorOfItemIndex', floorOfItemIndex);
        Alpine.store('heightOfBarItemIndex', heightOfBarItemIndex);
        Alpine.store('widthOfBarItem', widthOfBarItem);
        Alpine.store('stretchBtnClick', stretchBtnClick);
        Alpine.store('maxBarHeight', Alpine.store('sectionHeight') * 0.6);
        Alpine.store('sectionItemHeight', 0.6 * Alpine.store('sectionHeight'));
        Alpine.store(
          'sectionItemMargin',
          (Alpine.store('sectionHeight') - Alpine.store('sectionItemHeight')) /
            2
        );
        Alpine.store('pixelsPerMonth', Alpine.reactive({ width: 20 }));
      });

      document.addEventListener('alpine:initialized', () => {
        tippy('[data-tippy-content]');
      });
    </script>
  </head>

  <body x-data="$store.timelineData">
    <div
      class="fixed flex flex-col inset-0 items-center p-4 z-10"
      :style="`height:${$store.headerHeight}; background-color: rgb(51, 51, 51)`"
    >
      <div class="w-20 h-20">
        <img class="rounded-full" :src="$store.timelineData.avatar" />
      </div>
      <div class="text-2xl text-white" x-text="$store.timelineData.name"></div>
      <div class="text-gray-400" x-text="$store.timelineData.bio"></div>
      <div
        class="rounded-full text-gray-300 text-xs px-2 mt-1 cursor-pointer"
        @click="$store.stretchBtnClick($refs.timelinearea)"
        :style="`height:20px; line-height: 20px; background-color:rgb(0,0,0,0.6)`"
        x-text="$store.pixelsPerMonth.width == 20 ? 'â†â†’' : 'â†’â†'"
      ></div>
    </div>

    <div
      class="relative overflow-hidden"
      :style="`min-height: calc(100vh - ${$store.headerHeight}px); margin-top: ${$store.headerHeight}px`"
    >
      <div class="absolute w-48 bg-white border-r border-gray-600">
        <div
          class="border-b border-gray-600"
          :style="`height: ${$store.monthBarHeight}px`"
        ></div>
        <template x-for="section in timeline">
          <div
            class="border-b border-gray-600 pl-2 text-sm"
            x-text="section.title"
            :style="`height: ${$store.sectionTotalHeight(section)}px; line-height: ${$store.sectionHeight}px`"
          ></div>
        </template>
      </div>
      <div
        class="relative h-full"
        :style="`height: ${$store.timelineHeight() + $store.monthBarHeight}px`"
      >
        <div
          class="ml-48 h-full overflow-y-scroll relative"
          x-ref="timelinearea"
        >
          <template x-for="(item, index) in $store.timelineDates">
            <div
              class="h-full bg-gray-600 absolute"
              :style="`width:${index == 0 ? 0 : 1}px; left: ${$store.pixelsPerMonth.width*12*index}px`"
            ></div>
          </template>
          <div
            class="h-full text-sm"
            :style="`width: ${($store.endYear - $store.timelineData.startYear + 1)*12*$store.pixelsPerMonth.width}px;z-index:-1; background-image:radial-gradient(1px 1px at center, #ccc, transparent 1px);background-position:-${$store.pixelsPerMonth.width/2}px 0;background-size:${$store.pixelsPerMonth.width}px 6px`"
          >
            <div
              class="flex border-b border-gray-600 bg-white"
              :style="`height: ${$store.monthBarHeight}px;`"
            >
              <template x-for="item in $store.timelineDates">
                <div>
                  <div
                    class="text-center h-full"
                    x-text="item.year"
                    :style="`height:${$store.monthBarHeight}px; line-height:${$store.monthBarHeight}px; width:${$store.pixelsPerMonth.width*12}px;`"
                  ></div>
                </div>
              </template>
            </div>

            <template x-for="section in timeline">
              <div
                class="border-b relative border-gray-600 flex items-center"
                :style="`height: ${$store.sectionTotalHeight(section)}px; line-height: ${$store.sectionHeight}px`"
              >
                <template x-if="section.displayType == 'line'">
                  <template x-for="(item, index) in section.items">
                    <div
                      class="
                        absolute
                        overflow-hidden
                        rounded-full
                        text-xs text-white
                      "
                      x-html="item.url ? `<a target='_blank' class='underline' href='${item.url}'>${item.desc}</a>` : item.desc"
                      :data-tippy-content="item.desc ? item.desc : section.title"
                      :style="`background-color:${$store.lineColor};top:${$store.sectionItemMargin + $store.floorOfItemIndex(section, index)[1] * ($store.sectionItemMargin + $store.sectionItemHeight)}px; padding-left:6px;height:${$store.sectionItemHeight}px; line-height: ${$store.sectionItemHeight}px; left: ${$store.convertDateToPixels(item.startDate)}px; width:${($store.monthsBetweenDates(item.startDate, item.endDate)+1)*$store.pixelsPerMonth.width}px;`"
                    ></div>
                  </template>
                </template>
                <template x-if="section.displayType == 'bar'">
                  <template x-for="(item, index) in section.items">
                    <div
                      class="h-full absolute flex flex-col-reverse"
                      :style="`left: ${$store.convertDateToPixels(item.startDate)}px; width:${$store.widthOfBarItem(item)}px;`"
                      :data-tippy-content="item.value + `${section.valueDesc ? section.valueDesc : ''}` + `${item.desc ? ' ('+item.desc+')' : ''}`"
                    >
                      <div
                        class=""
                        :style="`background-color:${$store.barColor};top:${$store.sectionHeight - $store.heightOfBarItemIndex(section, index)}px; height:${$store.heightOfBarItemIndex(section, index)}px;`"
                      ></div>
                    </div>
                  </template>
                </template>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- è¯·ä¿ç•™è¿™ä¸ªå°ä¸œä¸œï¼Œè°¢è°¢ -->
      <div class="mt-2 opacity-10 flex flex-col items-center">
        <a href="https://limboy.me" target="_blank">ğŸ‘»</a>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.1/dist/tippy-bundle.umd.min.js"></script>
  </body>
</html>
